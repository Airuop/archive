name: Crul

on:

  workflow_dispatch:
  schedule:
   - cron: "0 0,12 * * *"  

jobs:

  run-script:

    runs-on: ubuntu-latest 

    steps:

    - uses: actions/checkout@v2

    - name: Run crul
      run: |
        wget https://raw.githubusercontent.com/yebekhe/TelegramV2rayCollector/main/sub/reality
        mv reality $(date '+%Y-%m-%d').txt
    - name: Upload output file
      uses: actions/upload-artifact@v2
      with:
        name: output-file
        path: $(date '+%Y-%m-%d').txt

  download-output:

    needs: run-script

    runs-on: ubuntu-latest

    steps:

    - uses: actions/checkout@v2

    - name: Download output file
      uses: actions/download-artifact@v2
      with: 
        name: output-file
        path: ./

    - name: Commit file
      run: |        
        git config --local user.email "actions@github.com"
        git config --local user.name "GitHub Actions"
        git pull origin main
        git add ./Js/$(date '+%Y-%m-%d').txt
        git commit -m "✔️ $(date '+%Y-%m-%d %H:%M:%S') Done"
        git push
